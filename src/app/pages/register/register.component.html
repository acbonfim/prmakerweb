<div>
  <mat-card appearance="outlined"
            style="background-color: #363636; border-radius: 10px;">
    <mat-card-header class="p-3"
                     style="background-color: #252525; border-radius: 10px">
      <mat-card-title class="" style="display: flex; align-items: center; gap: 8px;">
        <mat-icon>merge</mat-icon>
        Criação de template para Pull Requests
      </mat-card-title>
    </mat-card-header>
  <mat-card-content>
    <div class="mt-2 mb-2 row" style="display: flex; align-items: flex-start; gap: 15px; margin-top: 10px;">
      <p-inputgroup styleClass="custom-input-group" class="col-12 col-md-6 w-100">
        <p-inputnumber
          [(ngModel)]="cardNumber"
          placeholder="Número do card"
          inputId="minmaxfraction"
          mode="decimal" [useGrouping]="false">
        </p-inputnumber>
        <p-inputgroup-addon>
          <p-button
            (onClick)="getPullRequestByEnvironmentAndUserAndCardNumber()"
            [disabled]="!userSelected || !cardNumber || !environment || isPullRequestLoading"
            icon="pi pi-search" severity="secondary" variant="text" />
        </p-inputgroup-addon>
      </p-inputgroup>



      <p-selectbutton class="col-12 col-md-6"
        [options]="justifyOptions"
                      [(ngModel)]="environment"
                      (onChange)="onBranchChange()"
                      optionLabel="label"
                      optionValue="value"
                      styleClass="custom-select-button">
      </p-selectbutton>
    </div>


    @if (template !== null){
      <button matButton
              (click)="openDialogTemplate()"
              matTooltip="Clique para ver o template carregado"
              matTooltipPosition="above"
              style="margin-bottom: 10px"><mat-icon>article_shortcut</mat-icon>Template carregado</button>
    }

    @if (fullDescription !== null){
      <button matButton
              (click)="openDialogFullDescription()"
              matTooltip="Clique para ver a descrição completa"
              matTooltipPosition="above"
              style="margin-bottom: 10px"><mat-icon>article_shortcut</mat-icon>Descrição montada</button>
    }


    <mat-form-field class="full-width" style="height: 100%">
      <mat-label>Descrição</mat-label>
      <textarea [(ngModel)]="pullRequest.description" (ngModelChange)="generateFullDescriptionHandler()"  matInput placeholder="Ex. It makes me feel..." cols="30" rows="4"></textarea>
    </mat-form-field>

    <mat-form-field class="full-width">
      <mat-label>Root Cause</mat-label>
      <textarea [(ngModel)]="pullRequest.rootCause" (ngModelChange)="generateFullDescriptionHandler()" matInput placeholder="Ex. It makes me feel..." cols="30" rows="4"></textarea>
    </mat-form-field>


  </mat-card-content>
  <mat-card-actions style="background-color: #5b5b5b; margin-top: 20px; border-radius: 10px;">
    @if(!isMobile){
      <button mat-raised-button
              [disabled]="isPullRequestLoading || fullDescription === null"
              (click)="copyFullDescriptionToClipboard()">Copiar<mat-icon>content_copy</mat-icon></button>
      <button mat-raised-button style="margin-left: 10px"
              (click)="openGithubPullRequestPage()"
              [disabled]="!this.pullRequest?.description">Abrir PR<mat-icon>merge</mat-icon></button>

      <button mat-raised-button style="margin-left: 10px"
              [disabled]="isPullRequestLoading || fullDescription === null"
              (click)="savePullRequest()">Salvar<mat-icon>save</mat-icon></button>
      <button mat-raised-button style="margin-left: 10px"
              [disabled]="isPullRequestLoading || fullDescription === null"
              (click)="clearAll()">Limpar<mat-icon>clear</mat-icon></button>
      <button mat-raised-button style="margin-left: 10px"
              [disabled]="!cardNumber"
              (click)="openDialogPrompt()">Gerar Prompt<mat-icon>model_training</mat-icon></button>
      <button mat-raised-button disabled style="margin-left: 10px"
      >Salvar RC no DevOps<mat-icon>beenhere</mat-icon></button>
      <button disabled mat-raised-button matTooltip="Em breve" style="margin-left: 10px">Gerar com IA<mat-icon>model_training</mat-icon></button>
    } @else {
      <p-splitbutton style="width: 100% !important"
        label="Salvar"
                     icon="pi pi-save"
                     [disabled]="isPullRequestLoading || fullDescription === null"
                     [model]="mobileButtons" (onClick)="savePullRequest()" rounded severity="secondary" />
    }




  </mat-card-actions>
</mat-card>
</div>
<ngx-loading-bar></ngx-loading-bar>

